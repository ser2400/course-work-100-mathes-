#include <ctest.h>
#include <matches.h>

CTEST(check_queue, turn_inversion)
{
	// GIVEN
	int check = turn_inversion(1);
	int check2 = turn_inversion(2);

	// WHEN
	int expected = 2;
	int expected2 = 1;
	
	// THEN
	ASSERT_EQUAL(expected, check);
	ASSERT_EQUAL(expected2, check2);
}

CTEST(check_result, check_win_lose_end)
{
	// GIVEN
	int expected_win = 1;
	// WHEN
	int check_win = check_result(1, -1, 0, 1);
	// THEN
	ASSERT_EQUAL(expected_win, check_win);

	// GIVEN
	int expected_lose = 0;
	// WHEN
	int check_lose = check_result(2, -1, 0, 1);
	// THEN
	ASSERT_EQUAL(expected_lose, check_lose);

	// GIVEN
	int expected = 3;
	// WHEN
	int check = check_result(0, 0, 0, 0);
	// THEN
	ASSERT_EQUAL(expected, check);
}

CTEST(strategy_move, correct_moves_of_man)
{
	int check_miscalculation = 0;   // ???????? ????????, ??????? ?????????, ???????? ?? ??????? ??????
	int buffer = 8; // ????????? ??? ??????????(? ?????? ????? ?? ????? ??, ??? ?????????, ?????, ????? ????? 2-? ????? = 11)
	// GIVEN
	int expected = 0;
	// WHEN
	strategy_move(89, 2, &buffer, 3, &check_miscalculation, 78); // ???? ??? ????? ??? 8, ?? ? ???? ????? ?????????????? ??? ???. = 3
	int new_miscalculation = check_miscalculation; // (???? ?????) ????????, ?? ?????????? ?? ??????????? ??????????
	// THEN
	ASSERT_EQUAL(expected, new_miscalculation);
}

CTEST(strategy_move, incorrect_moves_of_man) 
{
	// ??? ?????? < 11
	int check_miscalculation = 0;
	int buffer = 7;

	// GIVEN
	int expected_mis = 1; // ??? ??? ???? ????????? ??????
	int expected_buf = 2; // ??? ??????????, ??????? ??????? ?? 2-? ??????????
	// WHEN
	strategy_move(79, 2, &buffer, 2, &check_miscalculation, 67);
	int new_miscalculation = check_miscalculation;
	int new_buffer = buffer;
	// THEN
	ASSERT_EQUAL(expected_mis, new_miscalculation);
	ASSERT_EQUAL(expected_buf, new_buffer);


	// ??? ?????? > 11
	check_miscalculation = 0;
	buffer = 7;

	// GIVEN
	expected_mis = 1; // ??? ??? ???? ????????? ??????
	expected_buf = 8; // ??? ??????????, ??????? ??????? ?? 2-? ??????????
	// WHEN
	strategy_move(79, 2, &buffer, 7, &check_miscalculation, 67);
	new_miscalculation = check_miscalculation;
	new_buffer = buffer;
	// THEN
	ASSERT_EQUAL(expected_mis, new_miscalculation);
	ASSERT_EQUAL(expected_buf, new_buffer);
}

CTEST(strategy_move, desperate_strategy)
{
	// ??? ????????
	int check_miscalculation = 0; // ?????? ?????? ??? ??????? ??????? (? ????? ?????????? ???? ????? 0)

	int matches_remain = 85; // ???. ???-?? ??????, ??? ???? ?? ??? ??????? ?? 2-?? ??????????
	int buffer = 5; // ??? ?????????? ? ?????????? ??? (?? ?? ??? ?? ?????? ? ?????? ??????)
	int input = 4; // ??? ????????, ????????? ????? 89 ???. ??????

	// GIVEN
	int expected = 7; // ??? ??????????, ??????? ??????? ?? 2-? ??????????
	// WHEN
	strategy_move(matches_remain, 1, &buffer, input, &check_miscalculation, 78);
	int new_buffer = buffer;
	// THEN
	ASSERT_EQUAL(expected, new_buffer);


	// ??? ??????????
	check_miscalculation = 0; // ?????? ?????? ??? ??????? ??????? (? ????? ?????????? ???? ????? 0)

	int checked_buffer;
	matches_remain = 78; // ???. ???-?? ??????, ??? ???? ?? ??? ??????? ?? 3-?? ??????????
	buffer = 5; // ??? ??????????
	input = 6; // ??? ???????? (??????????)

	// GIVEN
	expected = 1; 
	// WHEN
	strategy_move(matches_remain, 2, &buffer, input, &check_miscalculation, 67); // ??????? ???? = 2(?????? ????????)
	if (buffer >= 0 && buffer <= 10) { // ????????? ????????, ??????? ?????????? ? ????????? ???????
		checked_buffer = 1;				// ??? ??? ? ???? ?????? ????? ????? ?? ??????????? ?????? ????
	} else {							// ????????? 11
		checked_buffer = 0;
	}
	// THEN
	ASSERT_EQUAL(expected, checked_buffer);
}

CTEST(check_ramain, check_input)
{
	//GIVEN
	int turn = check_input(0);
	int turn1 = check_input(1);
	int turn2 = check_input(2);
	int turn3 = check_input(9);
	int turn4 = check_input(10);
	int turn5 = check_input(11);
	int turn6 = check_input(-1);

	//WHEN
	int expected = 1;
	int expected1 = 0;

	//THEN
	ASSERT_EQUAL(expected1, turn);
	ASSERT_EQUAL(expected, turn1);
	ASSERT_EQUAL(expected, turn2);
	ASSERT_EQUAL(expected, turn3);
	ASSERT_EQUAL(expected, turn4);
	ASSERT_EQUAL(expected1, turn5);
	ASSERT_EQUAL(expected1, turn6);
}

CTEST(strategy, last_situation)
{
	//GIVEN
	int check_miscalculation = 1;
	int first = 2;
	int matches_remain = 9;
	int buffer = 8;
	int input = 3;

	//WHEN
	int new_buffer = 8;
	strategy(matches_remain, first, &buffer, input, &check_miscalculation);

	//THEN
	ASSERT_EQUAL(buffer, new_buffer);

	//GIVEN
	check_miscalculation = 0;
	first = 2;
	matches_remain = 11;
	buffer = 5;
	input = 1;

	//WHEN
	new_buffer = 10;
	strategy(matches_remain, first, &buffer, input, &check_miscalculation);

	//THEN
	ASSERT_EQUAL(buffer, new_buffer);

	//GIVEN
	check_miscalculation = 0;
	first = 1;
	matches_remain = 12;
	buffer = 5;
	input = 6;

	//WHEN
	new_buffer = 5;
	strategy(matches_remain, first, &buffer, input, &check_miscalculation);

	//THEN
	ASSERT_EQUAL(buffer, new_buffer);
}
